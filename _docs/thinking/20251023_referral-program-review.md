# 思考ログ：紹介制度設計レビュー

**更新日**: 2025-10-23

## 概要

提案された紹介制度を、マーケティングと技術の両観点から評価し、改善案を提示する。

## 提案内容の要約

- **目的**: 有料転換率最優先、次に新規登録数
- **リワード**: 友だち14日、紹介者30日（友だちの3日連続ログ達成時）
- **対象**: iOS先行、全ユーザーが紹介可能、新規のみ受け入れ
- **導線**: 設定画面の招待カード → ディープリンク共有
- **KPI**: K係数≥1.0、30日以内有料化率

---

## マーケティング観点のレビュー

### ✅ 優れている点

1. **非対称リワードの採用**
   - 友だち即時14日：初期体験を厚くし、登録障壁を下げる
   - 紹介者30日（条件付き）：質の高い紹介を促進、空振りを防ぐ
   - **評価**: 💯 紹介の質と量のバランスが取れている

2. **行動トリガーの明確性**
   - 「3日連続ログ」という具体的な達成条件
   - 曖昧さがなく、不正防止にも有効
   - **評価**: 💯 エンゲージメント指標と直結

3. **有料転換率を最優先KPI**
   - 登録数だけを追わない健全な設計
   - LTV（顧客生涯価値）を重視
   - **評価**: 💯 持続可能な成長を目指している

### ⚠️ 改善すべき点

1. **「最大30日」の表現が曖昧**
   - 「最大」が何を指すのか不明確（人数上限？期間上限？）
   - 実際は「1人達成 = 30日」なら「最大」は不要
   - **提案**: 「友だち1人で30日延長」と明記

2. **K係数≥1.0の実現性**
   - 1人が1人以上紹介するのは非常に高いハードル
   - 初期フェーズでは0.3〜0.5でも十分優秀
   - **提案**: 初期目標をK=0.5、成熟期にK=0.8〜1.0を目指す

3. **14日 vs 30日のバランス**
   - 紹介者リワードが友だちの2倍以上（30日 vs 14日）
   - 紹介者の方が条件が厳しいのに報酬が大きい = 紹介インセンティブが強すぎる可能性
   - **懸念**: スパム的な紹介が増えるリスク
   - **提案**: 
     - 案A: 友だち14日、紹介者21日（1.5倍）に調整
     - 案B: 友だち7日、紹介者14日（通常の2倍）に調整
     - 案C: 現行維持（ただし不正検知を強化）

4. **iOS先行のリスク**
   - ネットワーク効果が分断される（iOS→Android紹介が機能しない）
   - 「Android版はいつ？」という問い合わせ対応コストが発生
   - **提案**: Android版も同時リリース（技術的に可能であれば）

5. **月間カロリー差分のペイウォール**
   - プレミアム特典として「月間カロリー差分表示」を解放
   - **懸念**: この機能が十分に魅力的か？他の特典も必要では？
   - **提案**: プレミアム特典を複数用意
     - 過去90日の履歴保存（無料は30日）
     - AI翻訳無制限（無料は月5回）
     - エクスポート機能（PDF/CSV）
     - カスタム栄養目標（PFCバランス細かく設定）

6. **共有チャネルの選定**
   - LINE / Instagram / X / WhatsApp
   - **評価**: 妥当だが、日本市場ではLINEが圧倒的に強い
   - **提案**: LINEをプライマリに、他をセカンダリに位置づけ

---

## 技術観点のレビュー

### ✅ 実装可能な要素

1. **ディープリンク追跡**
   - `meallog://invite?referrer={userId}` 形式
   - Expo Linking API でサポート済み
   - **評価**: 問題なし

2. **3日連続ログの判定**
   - `MealLog` テーブルの `createdAt` から連続日数を計算
   - タイムゾーン考慮が必要（既存の `timezone` フィールド活用）
   - **評価**: 実装可能

3. **プレミアム期間管理**
   - 新テーブル `PremiumSubscription` を追加
   - `startDate`, `endDate`, `source` (referral/purchase) を記録
   - **評価**: 問題なし

### ⚠️ 技術的課題

1. **重複防止の強度**
   - 「アカウント・端末・決済手段の重複チェック」と記載
   - **懸念**: 端末ID、決済手段の取得が困難（iOS App Tracking Transparency）
   - **提案**: 
     - メールアドレスのドメイン/パターンチェック
     - IP アドレス + User-Agent のハッシュ（簡易指紋）
     - 登録後の初期行動パターン分析（1時間以内に10人紹介 = 疑わしい）

2. **ディープリンク未インストール時の処理**
   - App Store → インストール → 初回起動時に紹介者IDを復元
   - **技術**: Universal Links (iOS) が必要
   - **課題**: サーバーサイドで `/.well-known/apple-app-site-association` を配信
   - **提案**: Phase 2 に回す。Phase 1 はアプリインストール済みユーザー間のみ

3. **プレミアム期間の重複・延長ロジック**
   - 複数の友だちが達成 → 30日 × N 人で延長？
   - 既存プレミアム（課金）と紹介プレミアムの優先順位は？
   - **提案**: 
     - 延長は「現在の終了日 + 30日」で加算
     - 課金プレミアム > 紹介プレミアム（課金が優先）
     - 紹介プレミアムは同時に1つのみ有効（重複付与は延長のみ）

4. **iOS先行の場合のクロスプラットフォーム対策**
   - Android ユーザーが招待リンクを受け取った場合の挙動
   - **提案**: ランディングページを用意し、「iOS版先行、Android版は近日公開」と案内

---

## 選択理由と推奨案

### 案A: 現行設計をそのまま実装（最速）
- **メリット**: 最短で市場投入、効果測定が早い
- **デメリット**: 上記の課題を抱えたままローンチ
- **推奨度**: ⭐⭐⭐

### 案B: リワードバランスを調整して実装（推奨）
- **変更点**: 
  - 友だち14日 → 紹介者21日に調整
  - K係数目標を0.5に下げる
  - プレミアム特典を追加（履歴90日、AI翻訳無制限）
- **メリット**: 不正リスクを抑えつつ、魅力的なプログラム
- **デメリット**: 実装工数が若干増加（プレミアム特典の実装）
- **推奨度**: ⭐⭐⭐⭐⭐

### 案C: Android同時ローンチ（理想）
- **変更点**: iOS + Android 同時リリース
- **メリット**: ネットワーク効果が最大化、クロスプラットフォーム対応
- **デメリット**: 開発期間が2〜3週間伸びる
- **推奨度**: ⭐⭐⭐⭐（リソースがあれば）

---

## 最終推奨

**案B（リワードバランス調整版）を推奨**

理由：
1. 有料転換率を最優先するという目的に合致
2. 不正・スパムリスクを抑えられる
3. 実装工数の増加は最小限（2〜3日程度）
4. iOS先行でも十分な効果が見込める

調整内容：
- 友だち: 14日（変更なし）
- 紹介者: 21日（30日から調整）
- K係数目標: 0.5（1.0から調整）
- プレミアム特典: 月間カロリー差分 + 履歴90日保存

---

## ✅ 最終決定（2025-10-23）

ユーザーからのフィードバックを受けて、以下の仕様で実装を進める：

### 確定仕様
1. **リワード**: 友だち14日、紹介者**30日**（当初案を維持）
2. **KPI**: K係数≥**0.5**（調整案を採用）
3. **表現**: 「友だち1人で30日延長」（「最大」を削除）
4. **対象**: iOS先行（変更なし）
5. **プレミアム特典**: 
   - 月間カロリー差分表示
   - **過去90日の履歴保存**（無料は30日）
6. **共有チャネル**: LINEをプライマリ、他（Instagram/X/WhatsApp）をセカンダリに位置づけ

### 判断理由
- 紹介者30日維持: 紹介インセンティブを最大化し、初期のバイラル効果を重視
- 不正対策: デバイス指紋、大量紹介検知、手動レビューで対応
- プレミアム特典強化: 履歴90日保存を追加し、無料との差別化を明確に

---

## 次にやること

1. ✅ 調整案をユーザーと合意
2. ✅ 詳細な実装計画書を作成（DB設計、API設計、UI/UX）
3. 🔄 実装計画書を最終仕様に合わせて更新
4. フェーズ分割（Phase 1: 基本機能、Phase 2: 不正検知強化、Phase 3: Android対応）
