# Appleでサインイン 導入計画

## フェーズ別チェックリスト
- [x] フェーズ1: 設計と下準備
  - [x] 現状の認証・オンボーディング導線を確認
  - [x] 実装方針/責務分割(サーバー・クライアント)を決定しタスクを棚卸し
- [x] フェーズ2: 共有スキーマとバックエンド対応
  - [x] sharedパッケージにAppleリクエスト/レスポンススキーマを追加
  - [x] Edge関数authに `/api/login/apple` `/api/link/apple` を追加しJWT検証実装
  - [x] ローカルサーバー(authルート)にも同等のエンドポイントを追加
  - [x] DB/Prisma/SQLに appleSub 等のカラムとユニーク制約を追加
- [x] フェーズ3: モバイル依存関係とAPIクライアント
  - [x] `expo-apple-authentication` を追加し iOS 設定 (usesAppleSignIn など) 更新
  - [x] mobile APIクライアントに Apple サインイン/リンク呼び出しを追加
  - [x] Sessionストアに appleLinked 状態を格納
- [x] フェーズ4: UI実装
  - [x] ログイン画面に「Appleで続ける」ボタンと規約導線を追加
  - [x] オンボーディング完了後のApple連携促し画面を追加し未連携時に遷移
  - [x] キャンセル/エラーのi18n文言とUXを追加
- [ ] フェーズ5: 動作確認と仕上げ
  - [ ] iOS実機で新規Appleサインイン/既存メール衝突/キャンセルを確認
  - [ ] 既存メール・パスワードログイン回帰を確認
  - [ ] README/ドキュメント更新とリリース前チェック

## メモ
- AndroidではAppleボタン非表示/非対応。iOSのみ表示。
- AppleのPrivate Relayメールで既存メールと衝突する場合の扱いは「サーバーがコンフリクトを返し、ユーザーに既存メールでログインを案内する」方針。
