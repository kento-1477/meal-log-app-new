# ç´¹ä»‹åˆ¶åº¦å®Ÿè£…è¨ˆç”»æ›¸

**æ›´æ–°æ—¥**: 2025-10-23  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ã€å®Ÿè£…å¾…ã¡  
**å„ªå…ˆåº¦**: é«˜  
**æ¨å®šå·¥æ•°**: 10ã€œ12æ—¥ï¼ˆ1åæƒ³å®šï¼‰

---

## 0. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ç›®çš„
æœ‰æ–™è»¢æ›ç‡ã‚’æœ€å„ªå…ˆã§å‘ä¸Šã•ã›ã€æŒç¶šå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç²å¾—ã‚’å®Ÿç¾ã™ã‚‹ã€‚

### ãƒªãƒ¯ãƒ¼ãƒ‰è¨­è¨ˆï¼ˆæœ€çµ‚ç¢ºå®šç‰ˆï¼‰
- **å‹ã ã¡ï¼ˆè¢«ç´¹ä»‹è€…ï¼‰**: ç™»éŒ²æ™‚ã«å³æ™‚**14æ—¥é–“**ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸
- **ç´¹ä»‹è€…**: å‹ã ã¡ãŒ**3æ—¥é€£ç¶šãƒ­ã‚°é”æˆ**ã§**30æ—¥é–“**ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸ï¼ˆäººæ•°ç„¡åˆ¶é™ï¼‰
- **è¡¨ç¾**: ã€Œå‹ã ã¡1äººã§30æ—¥å»¶é•·ã€ï¼ˆã€Œæœ€å¤§30æ—¥ã€ã¨ã„ã†æ›–æ˜§ãªè¡¨ç¾ã¯ä½¿ã‚ãªã„ï¼‰
- **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰¹å…¸**: 
  - æœˆé–“ã‚«ãƒ­ãƒªãƒ¼å·®åˆ†è¡¨ç¤º
  - **éå»90æ—¥ã®å±¥æ­´ä¿å­˜**ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯30æ—¥ã®ã¿ï¼‰

### KPI
- **ä¸»è¦**: 30æ—¥ä»¥å†…ã®æœ‰æ–™åŒ–ç‡ï¼ˆç´¹ä»‹çµŒç”±ï¼‰
- **æ¬¡ç‚¹**: Kä¿‚æ•°ï¼ˆç›®æ¨™**â‰¥0.5**ã€æˆç†ŸæœŸ0.8ã€œ1.0ï¼‰ã€æ–°è¦ç™»éŒ²æ•°

### ã‚¹ã‚³ãƒ¼ãƒ—
- **Phase 1**: iOSå…ˆè¡Œã€åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…ï¼ˆã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ï¼‰
- **Phase 2**: ä¸æ­£æ¤œçŸ¥å¼·åŒ–ã€Analyticsçµ±åˆ
- **Phase 3**: Androidå¯¾å¿œã€Universal Linkså¯¾å¿œï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çµŒè·¯ï¼‰

---

## 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 1.1 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

#### âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: `Referral` ãƒ†ãƒ¼ãƒ–ãƒ«

```prisma
model Referral {
  id                Int       @id @default(autoincrement())
  referrerUser      User      @relation("ReferrerRelation", fields: [referrerUserId], references: [id], onDelete: Cascade)
  referrerUserId    Int
  referredUser      User      @relation("ReferredRelation", fields: [referredUserId], references: [id], onDelete: Cascade)
  referredUserId    Int       @unique
  status            ReferralStatus  @default(PENDING)
  friendPremiumGranted Boolean @default(false)
  referrerPremiumGranted Boolean @default(false)
  consecutiveDaysAchieved Int   @default(0)
  completedAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([referrerUserId])
  @@index([status])
}

enum ReferralStatus {
  PENDING      // å‹ã ã¡ç™»éŒ²æ¸ˆã¿ã€3æ—¥é€£ç¶šæœªé”æˆ
  COMPLETED    // 3æ—¥é€£ç¶šé”æˆã€ç´¹ä»‹è€…ã«ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸æ¸ˆã¿
  EXPIRED      // 30æ—¥çµŒéã—ã¦ã‚‚æœªé”æˆ
  FRAUD        // ä¸æ­£ã¨åˆ¤å®š
}
```

- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒã« `Referral` ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
- [ ] `ReferralStatus` enum ã‚’è¿½åŠ 
- [ ] `User` ãƒ¢ãƒ‡ãƒ«ã«é–¢é€£ã‚’è¿½åŠ ï¼ˆ`referralsMade`, `referredBy`ï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆdev, staging, prodï¼‰

#### âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: `PremiumGrant` ãƒ†ãƒ¼ãƒ–ãƒ«

```prisma
model PremiumGrant {
  id          Int             @id @default(autoincrement())
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  source      PremiumSource
  days        Int
  startDate   DateTime
  endDate     DateTime
  referral    Referral?       @relation(fields: [referralId], references: [id])
  referralId  Int?
  iapReceipt  IapReceipt?     @relation(fields: [iapReceiptId], references: [id])
  iapReceiptId Int?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([userId, endDate])
  @@index([source])
}

enum PremiumSource {
  REFERRAL_FRIEND    // å‹ã ã¡ã¨ã—ã¦æ‹›å¾…ã•ã‚ŒãŸ
  REFERRAL_REFERRER  // ç´¹ä»‹è€…ã¨ã—ã¦ç²å¾—
  PURCHASE           // èª²é‡‘è³¼å…¥
  ADMIN_GRANT        // ç®¡ç†è€…ä»˜ä¸
}
```

- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒã« `PremiumGrant` ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
- [ ] `PremiumSource` enum ã‚’è¿½åŠ 
- [ ] `User`, `Referral`, `IapReceipt` ã¨ã®é–¢é€£ã‚’è¨­å®š
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

#### âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: `ReferralInviteLink` ãƒ†ãƒ¼ãƒ–ãƒ«

```prisma
model ReferralInviteLink {
  id          Int       @id @default(autoincrement())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  code        String    @unique  // çŸ­ç¸®ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: "A3K9Px"ï¼‰
  clickCount  Int       @default(0)
  signupCount Int       @default(0)
  createdAt   DateTime  @default(now())
  lastUsedAt  DateTime?

  @@index([userId])
  @@index([code])
}
```

- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒã« `ReferralInviteLink` ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
- [ ] `User` ã¨ã®é–¢é€£ã‚’è¨­å®š
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### 1.2 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ä¿®æ­£

#### âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: `User` ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ

- [ ] `User` ã« `referralsMade` ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆ1å¯¾å¤šã€Referralã¸ï¼‰
- [ ] `User` ã« `referredBy` ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆ1å¯¾1ã€Referralã¸ï¼‰
- [ ] `User` ã« `premiumGrants` ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆ1å¯¾å¤šã€PremiumGrantã¸ï¼‰
- [ ] `User` ã« `inviteLinks` ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆ1å¯¾å¤šã€ReferralInviteLinkã¸ï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

---

## 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIè¨­è¨ˆ

### 2.1 æ‹›å¾…ãƒªãƒ³ã‚¯ç”ŸæˆAPI

#### âœ… ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `POST /api/referral/invite-link`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "timezone": "Asia/Tokyo"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "inviteLink": "meallog://invite?code=A3K9Px",
  "webLink": "https://meal-log.app/invite?code=A3K9Px",
  "code": "A3K9Px"
}
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `/api/referral/invite-link` ãƒ«ãƒ¼ãƒˆä½œæˆ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ä¸€æ„ã®çŸ­ç¸®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆ6æ–‡å­—ã€A-Za-z0-9ï¼‰
- [ ] `ReferralInviteLink` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ï¼ˆæ—¢å­˜ãªã‚‰å†åˆ©ç”¨ï¼‰
- [ ] ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ + Webãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ä¸¡æ–¹ã®URLã‚’è¿”å´
- [ ] èªè¨¼å¿…é ˆï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã€Œå‹ã ã¡1äººã§30æ—¥å»¶é•·ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å«ã‚ã‚‹

### 2.2 æ‹›å¾…ã‚³ãƒ¼ãƒ‰æ¤œè¨¼ãƒ»ç´ä»˜ã‘API

#### âœ… ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `POST /api/referral/claim`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "code": "A3K9Px",
  "timezone": "Asia/Tokyo"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "premiumDays": 14,
  "premiumUntil": "2025-11-06T23:59:59Z",
  "referrerUsername": "TaroYamada"
}
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `/api/referral/claim` ãƒ«ãƒ¼ãƒˆä½œæˆ
- [ ] æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª
- [ ] é‡è¤‡é˜²æ­¢ãƒã‚§ãƒƒã‚¯ï¼ˆåŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°å›ä½¿ç”¨ä¸å¯ï¼‰
- [ ] `Referral` ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆstatus: PENDINGï¼‰
- [ ] å‹ã ã¡ã«14æ—¥ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸ï¼ˆ`PremiumGrant` ä½œæˆï¼‰
- [ ] `ReferralInviteLink` ã® `signupCount` ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
- [ ] èªè¨¼å¿…é ˆ

### 2.3 ãƒ—ãƒ¬ãƒŸã‚¢ãƒ çŠ¶æ…‹å–å¾—API

#### âœ… ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `GET /api/user/premium-status`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "isPremium": true,
  "source": "REFERRAL_FRIEND",
  "daysRemaining": 12,
  "expiresAt": "2025-11-06T23:59:59Z",
  "grants": [
    {
      "source": "REFERRAL_FRIEND",
      "days": 14,
      "startDate": "2025-10-23T00:00:00Z",
      "endDate": "2025-11-06T23:59:59Z"
    }
  ]
}
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `/api/user/premium-status` ãƒ«ãƒ¼ãƒˆä½œæˆ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ `PremiumGrant` ã‚’å–å¾—
- [ ] ç¾åœ¨æœ‰åŠ¹ãªãƒ—ãƒ¬ãƒŸã‚¢ãƒ æœŸé–“ã‚’è¨ˆç®—ï¼ˆæœ€ã‚‚é…ã„ `endDate` ã‚’æ¡ç”¨ï¼‰
- [ ] `isPremium` ãƒ•ãƒ©ã‚°ã‚’è¿”å´ï¼ˆç¾åœ¨æ—¥æ™‚ < endDateï¼‰
- [ ] èªè¨¼å¿…é ˆ

### 2.4 ç´¹ä»‹çŠ¶æ³å–å¾—API

#### âœ… ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `GET /api/referral/my-status`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "inviteCode": "A3K9Px",
  "inviteLink": "meallog://invite?code=A3K9Px",
  "stats": {
    "totalReferred": 5,
    "completedReferred": 2,
    "pendingReferred": 3,
    "totalPremiumDaysEarned": 42
  },
  "recentReferrals": [
    {
      "friendUsername": "HanakoSato",
      "status": "COMPLETED",
      "consecutiveDays": 3,
      "createdAt": "2025-10-20T10:00:00Z",
      "completedAt": "2025-10-23T10:00:00Z"
    },
    {
      "friendUsername": "User_1234",
      "status": "PENDING",
      "consecutiveDays": 1,
      "createdAt": "2025-10-22T15:00:00Z",
      "completedAt": null
    }
  ]
}
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `/api/referral/my-status` ãƒ«ãƒ¼ãƒˆä½œæˆ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ `Referral` ã‚’å–å¾—ï¼ˆreferrerUserIdï¼‰
- [ ] çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—ï¼ˆtotal, completed, pending, days earnedï¼‰
- [ ] æœ€æ–°5ä»¶ã®ç´¹ä»‹çŠ¶æ³ã‚’è¿”å´
- [ ] èªè¨¼å¿…é ˆ

### 2.5 3æ—¥é€£ç¶šãƒ­ã‚°ãƒã‚§ãƒƒã‚¯ã‚¸ãƒ§ãƒ–

#### âœ… ãƒãƒƒãƒã‚¸ãƒ§ãƒ–: `check-referral-completion`

**å®Ÿè¡Œé »åº¦**: 1æ—¥1å›ï¼ˆåˆå‰3æ™‚ JSTï¼‰

**å‡¦ç†å†…å®¹**:
1. `Referral` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ `status = PENDING` ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨å–å¾—
2. å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€è¢«ç´¹ä»‹è€…ï¼ˆreferredUserï¼‰ã® `MealLog` ã‚’ç¢ºèª
3. ç›´è¿‘3æ—¥é–“ã«é€£ç¶šã—ã¦ãƒ­ã‚°ãŒã‚ã‚‹ã‹åˆ¤å®š
   - ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ï¼ˆ`UserProfile.language` ã‹ã‚‰æ¨æ¸¬ or ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ Asia/Tokyoï¼‰
   - å„æ—¥ã«1ä»¶ä»¥ä¸Šã®æœ‰åŠ¹ãƒ­ã‚°ï¼ˆdeletedAt IS NULL, zeroFloored = falseï¼‰
4. é”æˆã—ã¦ã„ã‚Œã°:
   - `Referral.status` ã‚’ `COMPLETED` ã«æ›´æ–°
   - `Referral.consecutiveDaysAchieved` ã‚’ 3 ã«è¨­å®š
   - `Referral.completedAt` ã‚’ç¾åœ¨æ™‚åˆ»ã«è¨­å®š
   - ç´¹ä»‹è€…ã«**30æ—¥**ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸ï¼ˆ`PremiumGrant` ä½œæˆï¼‰
   - `Referral.referrerPremiumGranted` ã‚’ true ã«è¨­å®š
5. 30æ—¥çµŒéã—ã¦ã‚‚æœªé”æˆãªã‚‰:
   - `Referral.status` ã‚’ `EXPIRED` ã«æ›´æ–°

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `apps/server/src/jobs/check-referral-completion.ts` ä½œæˆ
- [ ] 3æ—¥é€£ç¶šãƒ­ã‚°åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è€ƒæ…®ï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸å‡¦ç†ã‚’æŠ½è±¡åŒ–ï¼ˆ`PremiumGrantService.grantDays()`ï¼‰
- [ ] 30æ—¥æœŸé™åˆ‡ã‚Œãƒã‚§ãƒƒã‚¯å®Ÿè£…
- [ ] Cronè¨­å®šï¼ˆpackage.jsonã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ï¼‰
- [ ] ãƒ­ã‚°å‡ºåŠ›ï¼ˆPinoï¼‰

---

## 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆMobileï¼‰å®Ÿè£…

### 3.1 æ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ»å…±æœ‰æ©Ÿèƒ½

#### âœ… å®Ÿè£…ç®‡æ‰€: `apps/mobile/app/(tabs)/settings.tsx`

**å¤‰æ›´å†…å®¹**:
- [ ] `handleInvite` é–¢æ•°ã‚’å®Ÿè£…
  - API `/api/referral/invite-link` ã‚’å‘¼ã³å‡ºã—
  - æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’å–å¾—
  - `Share.share()` ã§å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
    - ã‚¿ã‚¤ãƒˆãƒ«: ã€ŒMeal Logã‚’ä¸€ç·’ã«ä½¿ã„ã¾ã›ã‚“ã‹ï¼Ÿã€
    - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€Œç´¹ä»‹ãƒªãƒ³ã‚¯ã‹ã‚‰ç™»éŒ²ã™ã‚‹ã¨14æ—¥é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç„¡æ–™ï¼å‹ã ã¡ã‚’ç´¹ä»‹ã™ã‚‹ã¨30æ—¥å»¶é•·ã‚‚ï¼ {inviteLink}ã€
- [ ] å…±æœ‰ãƒãƒ£ãƒãƒ«ãƒœã‚¿ãƒ³è¿½åŠ ï¼ˆ**LINEã‚’ãƒ—ãƒ©ã‚¤ãƒãƒª**ã€ä»–ã‚’ã‚»ã‚«ãƒ³ãƒ€ãƒªï¼‰
  - **LINE**: `line://msg/text/{message}` - **å¤§ããç›®ç«‹ã¤ãƒœã‚¿ãƒ³**
  - Instagram: DMä¸å¯ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æŠ•ç¨¿ã®ã¿ï¼ˆ`instagram://story-camera`ï¼‰- å°ã•ã‚ãƒœã‚¿ãƒ³
  - X: `twitter://post?message={message}` - å°ã•ã‚ãƒœã‚¿ãƒ³
  - WhatsApp: `whatsapp://send?text={message}` - å°ã•ã‚ãƒœã‚¿ãƒ³
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€APIã‚¨ãƒ©ãƒ¼ï¼‰
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤º

#### âœ… ç¿»è¨³è¿½åŠ : `apps/mobile/src/i18n/index.ts`

- [ ] `referral.share.title`: ã€ŒMeal Logã‚’ä¸€ç·’ã«ä½¿ã„ã¾ã›ã‚“ã‹ï¼Ÿã€
- [ ] `referral.share.message`: ã€Œã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ç™»éŒ²ã™ã‚‹ã¨14æ—¥é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç„¡æ–™ï¼å‹ã ã¡ã‚’ç´¹ä»‹ã™ã‚‹ã¨30æ—¥å»¶é•·ã‚‚ï¼ {{link}}ã€
- [ ] `referral.invite.rewardText`: ã€Œå‹ã ã¡1äººã§30æ—¥å»¶é•·ã€
- [ ] `referral.friend.rewardText`: ã€Œç´¹ä»‹ãªã‚‰14æ—¥é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç„¡æ–™ã€
- [ ] `referral.error.loadFailed`: ã€Œæ‹›å¾…ãƒªãƒ³ã‚¯ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€
- [ ] `referral.error.shareFailed`: ã€Œå…±æœ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€
- [ ] è‹±èªç‰ˆã‚‚è¿½åŠ 

### 3.2 ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯å—ä¿¡ãƒ»å‡¦ç†

#### âœ… å®Ÿè£…ç®‡æ‰€: `apps/mobile/app/_layout.tsx`

**å¤‰æ›´å†…å®¹**:
- [ ] `expo-linking` ã® `useURL()` ã§ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ã‚’ç›£è¦–
- [ ] `meallog://invite?code={code}` ã‚’æ¤œå‡º
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆ:
  - API `/api/referral/claim` ã‚’å‘¼ã³å‡ºã—
  - æˆåŠŸæ™‚: ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºã€Œ14æ—¥é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚’ç²å¾—ã—ã¾ã—ãŸï¼ã€
  - å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- [ ] æœªãƒ­ã‚°ã‚¤ãƒ³ã®å ´åˆ:
  - æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ™‚ä¿å­˜ï¼ˆAsyncStorage: `@referral_code`ï¼‰
  - ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«é·ç§»
  - ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è‡ªå‹•ã§ `/api/referral/claim` ã‚’å®Ÿè¡Œ

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `apps/mobile/src/hooks/useReferralDeepLink.ts` ä½œæˆ
- [ ] `_layout.tsx` ã«çµ±åˆ
- [ ] AsyncStorageã§ã‚³ãƒ¼ãƒ‰ä¸€æ™‚ä¿å­˜
- [ ] ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®è‡ªå‹•claimå®Ÿè£…
- [ ] ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥å®Ÿè£…

### 3.3 ç´¹ä»‹çŠ¶æ³ç”»é¢

#### âœ… æ–°è¦ç”»é¢: `apps/mobile/app/referral-status.tsx`

**UIæ§‹æˆ**:
1. ãƒ˜ãƒƒãƒ€ãƒ¼: ã€Œç´¹ä»‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€
2. æ‹›å¾…ã‚«ãƒ¼ãƒ‰:
   - æ‹›å¾…ã‚³ãƒ¼ãƒ‰è¡¨ç¤º
   - ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
   - å…±æœ‰ãƒœã‚¿ãƒ³
3. çµ±è¨ˆã‚«ãƒ¼ãƒ‰:
   - ç´¹ä»‹äººæ•°ï¼ˆåˆè¨ˆ/é”æˆ/å¾…æ©Ÿä¸­ï¼‰
   - ç²å¾—ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ—¥æ•°
4. ç´¹ä»‹ãƒªã‚¹ãƒˆ:
   - å‹ã ã¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆåŒ¿ååŒ–: "User_1234"ï¼‰
   - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆé”æˆ/å¾…æ©Ÿä¸­/æœŸé™åˆ‡ã‚Œï¼‰
   - é€£ç¶šæ—¥æ•°ãƒãƒƒã‚¸ï¼ˆ"2/3æ—¥" ãªã©ï¼‰
   - é”æˆæ—¥æ™‚

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `apps/mobile/app/referral-status.tsx` ä½œæˆ
- [ ] API `/api/referral/my-status` ã¨çµ±åˆ
- [ ] ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆFlatListï¼‰
- [ ] ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½å®Ÿè£…ï¼ˆClipboard APIï¼‰
- [ ] å…±æœ‰æ©Ÿèƒ½å®Ÿè£…ï¼ˆShare APIï¼‰
- [ ] è¨­å®šç”»é¢ã‹ã‚‰ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

### 3.4 ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒƒã‚¸ãƒ»æ®‹æ—¥æ•°è¡¨ç¤º

#### âœ… å®Ÿè£…ç®‡æ‰€: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€è¨­å®šç”»é¢

**å¤‰æ›´å†…å®¹**:
- [ ] API `/api/user/premium-status` ã‚’å‘¼ã³å‡ºã—
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ çŠ¶æ…‹ã‚’ Zustand store ã«ä¿å­˜
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒƒã‚¸è¡¨ç¤º
  - ã‚¢ã‚¤ã‚³ãƒ³: â­ï¸ or ğŸ‘‘
  - ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡ï¼ˆæ®‹ã‚Š12æ—¥ï¼‰ã€
- [ ] è¨­å®šç”»é¢ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ã«ãƒãƒƒã‚¸è¿½åŠ 
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šæ©Ÿèƒ½ã«éµã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `apps/mobile/src/store/premium.ts` ä½œæˆï¼ˆZustandï¼‰
- [ ] `/api/user/premium-status` çµ±åˆ
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒãƒƒã‚¸è¡¨ç¤º
- [ ] è¨­å®šç”»é¢ã«ãƒãƒƒã‚¸è¡¨ç¤º
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šæ©Ÿèƒ½ã®ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«å®Ÿè£…

---

## 4. ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰¹å…¸å®Ÿè£…

### 4.1 æœˆé–“ã‚«ãƒ­ãƒªãƒ¼å·®åˆ†è¡¨ç¤ºï¼ˆæ—¢å­˜æ©Ÿèƒ½ã®åˆ¶é™è¿½åŠ ï¼‰

- [x] æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼ˆ`dashboard.tsx`ï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡ã®ã¿è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«æ¡ä»¶åˆ†å²è¿½åŠ 
- [ ] ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯éµã‚¢ã‚¤ã‚³ãƒ³ + ã€Œãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šã€è¡¨ç¤º
- [ ] ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã‚¿ãƒƒãƒ—æ™‚ã«ç´¹ä»‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”»é¢ã¸èª˜å°

### 4.2 å±¥æ­´90æ—¥ä¿å­˜ï¼ˆæ–°æ©Ÿèƒ½ãƒ»ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰¹å…¸ï¼‰

#### âœ… å®Ÿè£…å†…å®¹

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**:
- [ ] `GET /api/logs` ã«æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
  - ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼: éå»**30æ—¥**ã®ã¿è¿”å´
  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼: éå»**90æ—¥**ã‚’è¿”å´
  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ åˆ¤å®šã¯ `PremiumGrant` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§
- [ ] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–ä¿®æ­£ï¼ˆ`log-cleanup.ts`ï¼‰
  - ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã¯30æ—¥ä»¥é™å‰Šé™¤ï¼ˆæ—¢å­˜ï¼‰
  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã¯90æ—¥ä»¥é™å‰Šé™¤ï¼ˆæ–°è¦ï¼‰
  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æœŸé–“ãŒçµ‚äº†ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯30æ—¥ãƒ«ãƒ¼ãƒ«ã«æˆ»ã‚‹

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**:
- [ ] å±¥æ­´ç”»é¢ã«æœŸé–“é¸æŠè¿½åŠ ï¼ˆã€Œ1ã‹æœˆã€ã€Œ3ã‹æœˆã€ï¼‰
- [ ] ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€Œ3ã‹æœˆã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ èª˜å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆã€Œ90æ—¥å±¥æ­´ã‚’è¦‹ã‚‹ã«ã¯å‹ã ã¡ã‚’æ‹›å¾…ã—ã¦ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã¸ï¼ã€ï¼‰
- [ ] èª˜å°ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—æ™‚ã«ç´¹ä»‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”»é¢ã¸é·ç§»

---

## 5. ä¸æ­£æ¤œçŸ¥ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 5.1 é‡è¤‡é˜²æ­¢

#### âœ… ãƒã‚§ãƒƒã‚¯é …ç›®

- [ ] ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œå‡ºï¼‰
- [ ] åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«ã™ã‚‹
  - `Referral.referredUserId` ã¯ UNIQUE åˆ¶ç´„
- [ ] è‡ªå·±ç´¹ä»‹é˜²æ­¢ï¼ˆreferrerUserId â‰  referredUserIdï¼‰
- [ ] IPã‚¢ãƒ‰ãƒ¬ã‚¹ + User-Agentã®ãƒãƒƒã‚·ãƒ¥ã‚’è¨˜éŒ²ï¼ˆç°¡æ˜“ãƒ‡ãƒã‚¤ã‚¹æŒ‡ç´‹ï¼‰
  - `Referral` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `deviceFingerprint` ã‚«ãƒ©ãƒ è¿½åŠ 
  - åŒä¸€fingerprintã§è¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚’æ¤œçŸ¥
- [ ] çŸ­æœŸé–“ã§ã®å¤§é‡ç´¹ä»‹ã‚’æ¤œçŸ¥ï¼ˆ1æ™‚é–“ã«10äººä»¥ä¸Š = ç–‘ã‚ã—ã„ï¼‰
  - ç®¡ç†è€…é€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ« or Slackï¼‰

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `/api/referral/claim` ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
- [ ] IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼ˆ`req.ip`ï¼‰
- [ ] User-Agentå–å¾—ï¼ˆ`req.headers['user-agent']`ï¼‰
- [ ] ãƒ‡ãƒã‚¤ã‚¹æŒ‡ç´‹ç”Ÿæˆï¼ˆSHA256ãƒãƒƒã‚·ãƒ¥ï¼‰
- [ ] å¤§é‡ç´¹ä»‹æ¤œçŸ¥ã‚¢ãƒ©ãƒ¼ãƒˆå®Ÿè£…

### 5.2 ä¸æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œçŸ¥

#### âœ… ç›£è¦–é …ç›®

- [ ] ç™»éŒ²å¾Œã™ãã«å‰Šé™¤ã•ã‚Œã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ1é€±é–“ä»¥å†…ã«å‰Šé™¤ = ç–‘ã‚ã—ã„ï¼‰
- [ ] 3æ—¥é€£ç¶šãƒ­ã‚°ãŒã™ã¹ã¦åŒä¸€å†…å®¹ï¼ˆã‚³ãƒ”ãƒšç–‘æƒ‘ï¼‰
- [ ] ç™»éŒ²å¾Œã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒç•°å¸¸ã«ä½ã„ï¼ˆ1é€±é–“ã§1å›ã®ã¿ï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æœŸé–“çµ‚äº†ç›´å‰ã«å¤§é‡ç´¹ä»‹ï¼ˆé§†ã‘è¾¼ã¿ç´¹ä»‹ï¼‰

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ä¸æ­£æ¤œçŸ¥ã‚¸ãƒ§ãƒ–ä½œæˆï¼ˆ`detect-referral-fraud.ts`ï¼‰
- [ ] ç–‘ã‚ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ `Referral.status = FRAUD` ã«æ›´æ–°
- [ ] ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ç–‘ã‚ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆå°†æ¥å®Ÿè£…ï¼‰

---

## 6. Analytics & KPIè¨ˆæ¸¬

### 6.1 ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

#### âœ… å®Ÿè£…ã‚¿ã‚¹ã‚¯

- [ ] `referral.invite_link_generated`: æ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆ
- [ ] `referral.invite_link_shared`: å…±æœ‰ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒãƒ£ãƒãƒ«è¨˜éŒ²ï¼‰
- [ ] `referral.invite_link_clicked`: æ‹›å¾…ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯
- [ ] `referral.signup_via_referral`: ç´¹ä»‹çµŒç”±ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
- [ ] `referral.premium_claimed_friend`: å‹ã ã¡ãŒãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç²å¾—
- [ ] `referral.premium_claimed_referrer`: ç´¹ä»‹è€…ãŒãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç²å¾—
- [ ] `referral.conversion_to_paid`: ç´¹ä»‹çµŒç”±ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª²é‡‘

**å®Ÿè£…ç®‡æ‰€**:
- [ ] `apps/mobile/src/analytics/events.ts` ã«ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©è¿½åŠ 
- [ ] å„APIãƒ»ç”»é¢ã§ `trackEvent()` å‘¼ã³å‡ºã—

### 6.2 KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆç®¡ç†è€…ç”¨ï¼‰

#### âœ… è¨ˆæ¸¬æŒ‡æ¨™

- [ ] Kä¿‚æ•°ï¼ˆ1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šç´¹ä»‹äººæ•°ï¼‰
- [ ] ç´¹ä»‹çµŒç”±ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ•°ï¼ˆæ—¥æ¬¡/é€±æ¬¡/æœˆæ¬¡ï¼‰
- [ ] 3æ—¥é€£ç¶šé”æˆç‡ï¼ˆCOMPLETED / TOTALï¼‰
- [ ] 30æ—¥ä»¥å†…æœ‰æ–™åŒ–ç‡ï¼ˆç´¹ä»‹çµŒç”± vs è‡ªç„¶æµå…¥ï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸ã‚³ã‚¹ãƒˆï¼ˆä»˜ä¸æ—¥æ•° Ã— äººæ•°ï¼‰
- [ ] ä¸æ­£æ¤œçŸ¥æ•°

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ç®¡ç†è€…ç”¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆï¼ˆ`/admin/referral/stats`ï¼‰
- [ ] SQLé›†è¨ˆã‚¯ã‚¨ãƒªå®Ÿè£…
- [ ] ç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…ï¼ˆå°†æ¥: Metabase or Retoolçµ±åˆï¼‰

---

## 7. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 7.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

- [ ] `ReferralService.createInviteLink()` ãƒ†ã‚¹ãƒˆ
- [ ] `ReferralService.claimReferral()` ãƒ†ã‚¹ãƒˆï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
- [ ] `PremiumGrantService.grantDays()` ãƒ†ã‚¹ãƒˆï¼ˆæœŸé–“è¨ˆç®—ï¼‰
- [ ] `ReferralService.checkConsecutiveDays()` ãƒ†ã‚¹ãƒˆï¼ˆ3æ—¥é€£ç¶šåˆ¤å®šï¼‰
- [ ] ãƒ‡ãƒã‚¤ã‚¹æŒ‡ç´‹ç”Ÿæˆãƒ†ã‚¹ãƒˆ

### 7.2 çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰: æ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆ â†’ å‹ã ã¡ç™»éŒ² â†’ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸
- [ ] ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰: 3æ—¥é€£ç¶šãƒ­ã‚° â†’ ç´¹ä»‹è€…ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸
- [ ] é‡è¤‡é˜²æ­¢: åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°å›ä½¿ç”¨ã§ããªã„ã“ã¨ã‚’ç¢ºèª
- [ ] è‡ªå·±ç´¹ä»‹é˜²æ­¢: è‡ªåˆ†è‡ªèº«ã‚’ç´¹ä»‹ã§ããªã„ã“ã¨ã‚’ç¢ºèª
- [ ] æœŸé™åˆ‡ã‚Œ: 30æ—¥çµŒéå¾Œã«EXPIREDã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª

### 7.3 æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

- [ ] iOSå®Ÿæ©Ÿã§ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯å‹•ä½œç¢ºèª
- [ ] å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‹•ä½œç¢ºèªï¼ˆLINE, X, WhatsAppï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒƒã‚¸è¡¨ç¤ºç¢ºèª
- [ ] ç´¹ä»‹çŠ¶æ³ç”»é¢ã®è¡¨ç¤ºç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèªï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€ä¸æ­£ã‚³ãƒ¼ãƒ‰ï¼‰

---

## 8. ãƒ‡ãƒ—ãƒ­ã‚¤è¨ˆç”»

### 8.1 Phase 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

**å®Ÿè£…ç¯„å›²**:
- DBè¨­è¨ˆãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIï¼ˆæ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆã€claimã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ çŠ¶æ…‹å–å¾—ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆæ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ»å…±æœ‰ã€ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯å—ä¿¡ï¼‰
- 3æ—¥é€£ç¶šãƒã‚§ãƒƒã‚¯ã‚¸ãƒ§ãƒ–
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒƒã‚¸è¡¨ç¤º

**æ¨å®šå·¥æ•°**: 7æ—¥

**ãƒªãƒªãƒ¼ã‚¹åˆ¤å®šåŸºæº–**:
- [ ] å…¨ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ‘ã‚¹
- [ ] å…¨çµ±åˆãƒ†ã‚¹ãƒˆãƒ‘ã‚¹
- [ ] iOSå®Ÿæ©Ÿã§æ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§E2Eãƒ†ã‚¹ãƒˆå®Œäº†

### 8.2 Phase 2: ä¸æ­£æ¤œçŸ¥ãƒ»Analyticsï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

**å®Ÿè£…ç¯„å›²**:
- ä¸æ­£æ¤œçŸ¥ã‚¸ãƒ§ãƒ–
- IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‡ãƒã‚¤ã‚¹æŒ‡ç´‹è¨˜éŒ²
- Analyticsã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- ç®¡ç†è€…ç”¨KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**æ¨å®šå·¥æ•°**: 3æ—¥

**ãƒªãƒªãƒ¼ã‚¹åˆ¤å®šåŸºæº–**:
- [ ] ä¸æ­£æ¤œçŸ¥ã‚¸ãƒ§ãƒ–ãŒæ­£å¸¸å‹•ä½œ
- [ ] Analyticsã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹
- [ ] ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§KPIç¢ºèªå¯èƒ½

### 8.3 Phase 3: Androidå¯¾å¿œãƒ»Universal Linksï¼ˆå„ªå…ˆåº¦: ä½ï¼‰

**å®Ÿè£…ç¯„å›²**:
- Androidç‰ˆãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯å¯¾å¿œ
- Universal Linksè¨­å®šï¼ˆ`/.well-known/apple-app-site-association`ï¼‰
- æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ä½œæˆ
- ã‚¹ãƒˆã‚¢è‡ªå‹•é·ç§»å®Ÿè£…

**æ¨å®šå·¥æ•°**: 4æ—¥

**ãƒªãƒªãƒ¼ã‚¹åˆ¤å®šåŸºæº–**:
- [ ] iOSæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«App Storeã«é·ç§»
- [ ] Androidæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«Google Playã«é·ç§»
- [ ] ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã«æ‹›å¾…ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•é©ç”¨

---

## 9. ãƒªã‚¹ã‚¯ç®¡ç†

### 9.1 é«˜ãƒªã‚¹ã‚¯é …ç›®

| ãƒªã‚¹ã‚¯ | å½±éŸ¿ | ç·©å’Œç­– | æ‹…å½“ |
|--------|------|--------|------|
| ä¸æ­£ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¤§é‡ç™ºç”Ÿ | é«˜ | ãƒ‡ãƒã‚¤ã‚¹æŒ‡ç´‹ã€ç®¡ç†è€…é€šçŸ¥ã€æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ | Backend |
| ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ãŒå‹•ä½œã—ãªã„ | ä¸­ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæ‰‹å‹•ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼‰ | Mobile |
| ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æœŸé–“ã®è¨ˆç®—ãƒŸã‚¹ | é«˜ | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå¾¹åº•ã€æ‰‹å‹•æ¤œè¨¼ | Backend |
| iOSå¯©æŸ»ã§ç´¹ä»‹åˆ¶åº¦ãŒå´ä¸‹ | é«˜ | App Storeå¯©æŸ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ç¢ºèªï¼ˆ3.2.2ï¼‰ | PM |

### 9.2 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»

- [ ] Phase 1ãƒªãƒªãƒ¼ã‚¹å¾Œã€1é€±é–“ã¯æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã§ON/OFFåˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«ã™ã‚‹
- [ ] ç·Šæ€¥æ™‚ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ‹›å¾…ã‚«ãƒ¼ãƒ‰ã‚’éè¡¨ç¤ºã«ã™ã‚‹
- [ ] DBãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ®‹ã—ã€ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ç„¡åŠ¹åŒ–

---

## 10. æˆåŠŸæŒ‡æ¨™ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### 10.1 åˆæœŸç›®æ¨™ï¼ˆãƒªãƒªãƒ¼ã‚¹å¾Œ30æ—¥ï¼‰

- [ ] Kä¿‚æ•° â‰¥ **0.3**ï¼ˆåˆæœŸãƒ•ã‚§ãƒ¼ã‚ºï¼‰
- [ ] ç´¹ä»‹çµŒç”±ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ•° â‰¥ 100äºº
- [ ] 3æ—¥é€£ç¶šé”æˆç‡ â‰¥ 40%
- [ ] 30æ—¥ä»¥å†…æœ‰æ–™åŒ–ç‡ â‰¥ 10%ï¼ˆç´¹ä»‹çµŒç”±ï¼‰

### 10.2 ä¸­æœŸç›®æ¨™ï¼ˆãƒªãƒªãƒ¼ã‚¹å¾Œ90æ—¥ï¼‰

- [ ] Kä¿‚æ•° â‰¥ **0.5**ï¼ˆä¸»è¦KPIï¼‰
- [ ] ç´¹ä»‹çµŒç”±ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ•° â‰¥ 500äºº
- [ ] 3æ—¥é€£ç¶šé”æˆç‡ â‰¥ 50%
- [ ] 30æ—¥ä»¥å†…æœ‰æ–™åŒ–ç‡ â‰¥ 15%ï¼ˆç´¹ä»‹çµŒç”±ï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç¶™ç¶šç‡ï¼ˆç´¹ä»‹çµŒç”±ï¼‰ â‰¥ 30%ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ æœŸé–“çµ‚äº†å¾Œã«èª²é‡‘ï¼‰

### 10.3 ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

- [ ] ä¸æ­£æ¤œçŸ¥æ•°ãŒ1æ—¥10ä»¶ã‚’è¶…ãˆãŸã‚‰Slacké€šçŸ¥
- [ ] 3æ—¥é€£ç¶šé”æˆç‡ãŒ20%ã‚’ä¸‹å›ã£ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆè¨­è¨ˆè¦‹ç›´ã—ï¼‰
- [ ] Kä¿‚æ•°ãŒ0.2ã‚’ä¸‹å›ã£ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–ï¼‰

---

## 11. æœªè§£æ±ºäº‹é …ãƒ»ä»Šå¾Œã®æ¤œè¨

- [ ] Androidç‰ˆã®å„ªå…ˆé †ä½ã‚’å†æ¤œè¨ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¦æœ›æ¬¡ç¬¬ï¼‰
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰¹å…¸ã®è¿½åŠ æ¤œè¨ï¼ˆAIç¿»è¨³ç„¡åˆ¶é™ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãªã©ï¼‰
- [ ] ç´¹ä»‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ï¼ˆä¸Šä½10åã«ãƒœãƒ¼ãƒŠã‚¹ï¼‰
- [ ] æ³•å‹™ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆåˆ©ç”¨è¦ç´„ã«ç´¹ä»‹åˆ¶åº¦ã®è¨˜è¼‰è¿½åŠ ï¼‰
- [ ] LINEã§ã®å…±æœ‰ä½“é¨“ã‚’æœ€é©åŒ–ï¼ˆOGPç”»åƒã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰

---

## 12. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `_docs/thinking/20251023_referral-program-review.md`: ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è¦³ç‚¹ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
- `_docs/specs/api-referral.md`: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜ï¼ˆä½œæˆäºˆå®šï¼‰
- `README.md`: ç’°å¢ƒæ§‹ç¯‰æ‰‹é †
- `Agent.md`: é–‹ç™ºãƒ—ãƒ­ãƒˆã‚³ãƒ«

---

**æœ€çµ‚æ›´æ–°**: 2025-10-23  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: Phase 1å®Ÿè£…å®Œäº†å¾Œï¼ˆæ¨å®š11æœˆä¸Šæ—¬ï¼‰
