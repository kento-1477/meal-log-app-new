# ダッシュボードレイアウト簡素化

**更新日**: 2025-10-23

## 目的

ダッシュボード画面の情報階層を整理し、最も重要な指標（カロリー達成率と月間トレンド）を視覚的に強調することで、ユーザーが一目で進捗を把握できるようにする。

## 背景

従来のダッシュボードでは以下の問題があった：
- 「残り（今日）」「摂取量（期間合計）」のサマリーセクションが上部にあり、視線がそこに集中してしまう
- TabBarで「カロリー」「主栄養素」を切り替える必要があり、情報へのアクセスに手間がかかる
- パーセンテージリングが画面下部にあり、最重要指標が目立たない

## 実装内容

### 画面構成の変更

**変更前:**
1. ヘッダー（タイトル、期間選択）
2. 「残り（今日）」セクション - kcal 673、P 45.5、F 24.4、C 69.6
3. 「摂取量（期間合計）」セクション - kcal 1528、P 84.5、F 45.7、C 190.4
4. 比較カード
5. TabBar（カロリー/主栄養素）
6. カロリーリング（69%）+ 月間差分カード
7. マクロリング3つ（P/F/C）
8. カロリーチャート、時間帯別バランス、最近の食事履歴

**変更後:**
1. ヘッダー（タイトル、期間選択、ストリーク）
2. **カロリーリング（69%）+ 月間差分カード** ← 最上部に移動
3. **マクロリング3つ（P/F/C）** ← 上部に移動
4. 比較カード
5. カロリーチャート
6. 時間帯別バランス
7. 最近の食事履歴

### 削除コンポーネント
- `SummaryHeader` コンポーネント（「残り（今日）」「摂取量（期間合計）」）
- `TabBar` コンポーネント（カロリー/主栄養素タブ切り替え）

### 追加機能
- **月間カロリー差分カード**: 今月の全日のカロリー差分を集計して表示
  - 計算ロジック: `Σ(実際の摂取カロリー - 目標カロリー)` for 今月の全記録日
  - カラーコーディング: 負の値（ダイエット成功）は緑、正の値（超過）は赤
  - サブタイトル: 記録日数と1日あたり平均差分を表示

### 変更ファイル

#### 新規作成
- なし（インラインコンポーネントとして実装）

#### 修正
- `apps/mobile/app/(tabs)/dashboard.tsx`
  - TabBar削除、activeState削除
  - SummaryHeader削除
  - MonthlyDeficitCard追加（インラインコンポーネント）
  - CalorieRing、MacroRing追加（リング表示をインライン実装）
  - レイアウト順序変更
  
- `apps/mobile/src/i18n/index.ts`
  - `dashboard.monthlyDeficit.title`: 月間カロリー差分
  - `dashboard.monthlyDeficit.subtitle`: {{days}}日間・平均 {{daily}}

#### 削除
- なし（コンポーネントは残存、importのみ削除）

## データの要点

### 月間差分計算ロジック
```typescript
// 今月の全エントリーを集計
summary.calories.daily.forEach((entry) => {
  const entryDate = DateTime.fromISO(entry.date, { zone: timezone });
  if (entryDate.hasSame(now, 'month') && entryDate.hasSame(now, 'year')) {
    const delta = entry.total - targetDaily;
    totalDelta += delta;
    dayCount++;
  }
});
```

### リング表示
- カロリーリング: 大サイズ（140px）
- マクロリング: 小サイズ（110px）
- パーセンテージ表示を統一（全て同じフォントサイズ）

## リスク

### 高リスク
- **情報の喪失**: 「残りカロリー」が削除されたことで、具体的な数値が見えにくくなる可能性
  - 緩和策: リングに「残り xxx kcal」を表示（既存機能）

### 中リスク
- **ユーザーの混乱**: レイアウトの大幅変更により、既存ユーザーが戸惑う可能性
  - 緩和策: リリースノートで変更を明示

### 低リスク
- **パフォーマンス**: 月間差分計算が追加されたが、既存データから計算するため影響は軽微

## 完了条件

- [x] SummaryHeaderコンポーネントを削除
- [x] TabBarコンポーネントを削除
- [x] リングを画面上部に移動
- [x] 月間カロリー差分カードを実装
- [x] 月間差分計算ロジックを実装（全日集計）
- [x] 翻訳キーを追加（ja-JP, en-US）
- [x] Lintエラーなし
- [x] デザインレビュー実施

## 次のステップ

デザインレビューの結果、以下の改善案が提案された：

### オプションA: 2x2グリッド統一レイアウト
- リングを全て同じサイズで2x2配置
- 月間差分カードを大きく独立表示

### オプションB: カード型レイアウト（推奨）
- リングを削除、パーセンテージのみ表示
- 月間差分カードをヒーロー表示
- シンプルで見やすいデザイン

### オプションC: タブ形式
- 「今日の進捗」「月間統計」タブで情報を整理
- 画面スクロール量を削減

今後、オプションBでの実装を検討。
