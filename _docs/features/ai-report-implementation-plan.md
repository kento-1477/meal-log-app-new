# AIレポート 実装計画書

## 現状と原因（高校生向け）
- 現状: AIアドバイスはチャット中心で、日次/週次/月次のレポート画面がない
- 現状: 期間を選ばず一気に作るとトークンが多く必要になる
- 現状: 栄養バランスに合わせた「食材の提案」が明確に出せていない
- 現状: 写真解析の流れからレポートに行く入口が弱い
- 原因: レポート用のAPI・画面・共通スキーマが未整備だった

## ゴール
- ユーザーが期間を選んでからAIレポートを生成する（トークン節約）
- 日次/週次/月次で「サマリー・主要指標・おすすめ食材・AIアドバイス」を表示
- 入口はチャットのクイックアクション（写真解析/お気に入りの横）に「レポート」

## 実装チェックリスト

### Phase 1: データ設計とAPI
- [x] 共通スキーマに `AiReport`（summary/metrics/advice/ingredients）を追加
- [x] `/api/reports` エンドポイントを追加（期間を受け取り、集計を作成）
- [x] 期間ごとのサマリーとコンテキスト生成（daily/weekly/monthly）
- [x] AIプロンプトとモック生成を実装
- [x] AI出力が不完全な時のパース/補完を実装
- [x] 栄養バランスに応じた食材提案ロジックを追加

### Phase 2: アプリUIと導線
- [x] レポート画面を追加（期間タブ + 生成ボタン + ローディング/エラー表示）
- [x] 期間を選んでから生成する導線にしてトークン消費を最小化
- [x] 「サマリー/主要指標/おすすめ食材/AIアドバイス」の表示カードを追加
- [x] チャットのクイックアクションに「レポート」を追加
- [x] i18n（日本語/英語）の文言を追加

### Phase 3: 動作確認
- [ ] 日次/週次/月次それぞれの生成と表示ができる
- [ ] 脂質/たんぱく質/炭水化物の偏りで食材提案が変わる
- [ ] 生成失敗時のメッセージ表示が正しい
- [ ] AI利用回数が正しく消費される

### Phase 4: 仕上げ
- [ ] 表示文言とUIの微調整
- [ ] 必要ならドキュメント更新
