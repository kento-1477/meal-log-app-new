import { useSyncExternalStore } from 'react';

type Locale = 'ja-JP' | 'en-US';

export const SUPPORTED_LOCALES: readonly Locale[] = ['ja-JP', 'en-US'] as const;
export const DEFAULT_LOCALE: Locale = 'ja-JP';

type TranslationTable = Record<string, string>;

const dictionaries: Record<Locale, TranslationTable> = {
  'ja-JP': {
    'dashboard.title': 'ダッシュボード',
    'dashboard.cacheNotice': 'オフラインのため、保存されたデータを表示しています。',
    'dashboard.requiresLogin': 'ログインが必要です。',
    'dashboard.loginHint': 'チャットタブからログインしてください。',
    'dashboard.loadError': 'データを取得できませんでした。',
    'dashboard.reloadHint': 'スワイプして再読み込みしてください。',
    'dashboard.empty.week': '今週の記録がありません',
    'dashboard.empty.generic': '記録がありません',
    'dashboard.logout': 'ログアウト',
    'dashboard.summary.remainingToday': '残り（今日）',
    'dashboard.summary.periodTotal': '摂取量（期間合計）',
    'dashboard.monthlyDeficit.title': '月間カロリー差分',
    'dashboard.monthlyDeficit.subtitle': '{{days}}日間・平均 {{daily}}',
    'button.record': '記録しに行く',
    'period.today': '今日',
    'period.yesterday': '昨日',
    'period.thisWeek': '今週',
    'period.lastWeek': '先週',
    'period.custom': 'カスタム期間',
    'period.previousRange': '前期間',
    'tab.calories': 'カロリー',
    'tab.macros': '主栄養素',
    'tab.nutrients': '栄養素一覧',
    'tab.chat': 'チャット',
    'tab.dashboard': 'ダッシュボード',
    'tab.settings': '設定',
    'macro.protein': 'たんぱく質',
    'macro.fat': '脂質',
    'macro.carbs': '炭水化物',
    'meal.breakfast': '朝食',
    'meal.lunch': '昼食',
    'meal.dinner': '夕食',
    'meal.snack': '間食',
    'meal.unknown': '未分類',
    'comparison.heading': '{{period}}との比較',
    'comparison.current': '現在',
    'comparison.previous': '前期',
    'comparison.target': '目標',
    'comparison.targetShort': '目標',
    'comparison.delta': '差分',
    'comparison.macroDelta': '{{delta}}g',
    'comparison.percentOfTarget': '目標比 {{value}}',
    'status.over': '超過',
    'status.under': '残り',
    'status.onTarget': '目標通り',
    'nutrients.header.nutrient': '栄養素',
    'nutrients.header.total': '合計',
    'nutrients.header.target': '目標',
    'nutrients.header.delta': '+/-',
    'mealDistribution.heading': '時間帯別バランス',
    'mealDistribution.current': '現在',
    'mealDistribution.previous': '前期',
    'mealDistribution.delta': '差',
    'macros.donut.title': 'PFCバランス',
    'macros.donut.legend.current': '現在',
    'remaining.calories': '残りカロリー',
    'remaining.caloriesOver': 'カロリー超過',
    'remaining.left': '{{nutrient}} 残り',
    'remaining.over': '{{nutrient}} 超過',
    'remaining.target': '目標 {{value}}',
    'rings.of_target': '現在 / 目標',
    'rings.left': '{{value}} {{unit}} 残り',
    'rings.over': '{{value}} {{unit}} 超過',
    'rings.no_target': '目標未設定',
    'rings.accessible': '{{label}} {{current}} {{unit}} / {{target}} {{unit}}、{{delta}} {{unit}} {{status}}',
    'rings.accessibleNoTarget': '{{label}} {{current}} {{unit}}、目標未設定',
    'recentLogs.heading': '最近の食事履歴',
    'recentLogs.empty': 'まだ記録がありません。最初の記録を追加しましょう。',
    'recentLogs.resetNotice': '無料プランでは記録が30日ごとにリセットされます。継続して記録を残したい場合は Standard プランをご検討ください。',
    'recentLogs.addMore': '記録する',
    'recentLogs.viewAll': 'すべて表示',
    'history.title': '食事履歴',
    'history.subtitle': '期間を切り替えて過去の記録を確認できます。',
    'history.range.today': '今日',
    'history.range.week': '1週間',
    'history.range.twoWeeks': '2週間',
    'history.range.threeWeeks': '3週間',
    'history.range.month': '1か月',
    'history.timezone': '表示時刻: {{timezone}}',
    'history.empty': 'この期間の記録はありません。',
    'history.delete.confirmTitle': '記録を削除しますか？',
    'history.delete.confirmMessage': '{{dish}} を削除します。よろしいですか？',
    'history.delete.failedTitle': '削除に失敗しました',
    'history.delete.failedMessage': 'しばらく待ってから再度お試しください。',
    'history.delete.successTitle': '削除しました',
    'history.delete.successMessage': '必要であれば「元に戻す」をタップしてください。',
    'history.delete.undo': '元に戻す',
    'history.restore.success': '履歴を復元しました',
    'history.restore.failed': '復元に失敗しました',
    'history.timeHistory.none': '未設定',
    'history.timeHistory.source.auto': '自動判定',
    'history.timeHistory.source.manual': '手動編集',
    'history.timeHistory.empty': '時間帯の変更履歴はありません。',
    'logs.deleteConfirm.title': '記録を削除しますか？',
    'logs.deleteConfirm.message': '削除すると一覧から非表示になります（元に戻すで復元できます）。',
    'logs.deleted.title': '削除しました',
    'logs.deleted.message': '必要であれば「元に戻す」をタップしてください。',
    'logs.deleted.undo': '元に戻す',
    'logs.deleted.failed': '削除に失敗しました',
    'logs.restore.failed': '復元に失敗しました',
    'logs.restore.success': '履歴を復元しました',
    'common.cancel': 'キャンセル',
    'common.delete': '削除',
    'common.close': '閉じる',
    'usage.limitModal.title': '無料利用上限に達しました',
    'usage.limitModal.message': '無料プランではAIの利用は1日{{limit}}回までです。引き続きご利用いただく場合は Standard プランへの変更をご検討ください。',
    'usage.limitModal.purchase': 'Standard プランに変更',
    'usage.limitModal.close': '閉じる',
    'usage.streakModal.title': '30日連続記録おめでとうございます！',
    'usage.streakModal.message': '無料プランでは30日ごとに記録がリセットされます。引き続きデータを残したい場合は Standard プランをご検討ください。',
    'usage.streakModal.upgrade': 'Standard プランに変更',
    'usage.streakModal.close': 'あとで',
    'usage.purchase.error': '購入に失敗しました',
    'usage.purchase.unsupported': 'このデバイスでは購入できません。App Store対応デバイスでお試しください。',
    'usage.purchase.success': 'クレジットを追加しました',
    'usage.plan.standard': 'Standard プラン',
    'usage.plan.free': '無料プラン',
    'usage.banner.remaining': '残り {{remaining}} / {{limit}} 回',
    'usage.banner.credits': 'クレジット {{credits}} 回分',
    'usage.limitHint': '本日の無料上限に達しました。Standard プランに変更すると記録を続けられます。',
    'export.header.date': '記録日時',
    'export.header.name': '料理名',
    'export.header.calories': 'カロリー(kcal)',
    'export.header.protein': 'たんぱく質(g)',
    'export.header.fat': '脂質(g)',
    'export.header.carbs': '炭水化物(g)',
    'export.title': '食事記録',
    'chat.header': '今日の食事',
    'chat.newLog': '新規登録',
    'chart.placeholder.insufficientData': '今日の推移はデータが足りません',
    'streak.days': '日継続中',
    'login.title': 'Meal Log',
    'login.subtitle': '食事を記録して、AI が栄養素を推定します。',
    'login.emailLabel': 'メールアドレス',
    'login.emailPlaceholder': 'example@example.com',
    'login.passwordLabel': 'パスワード',
    'login.passwordPlaceholder': '••••••••',
    'login.submit': 'ログイン',
    'login.error.generic': 'ログインに失敗しました',
    'login.register': '新規登録',
    'register.title': 'アカウント作成',
    'register.subtitle': 'メールアドレスとパスワードを入力してください。',
    'register.emailLabel': 'メールアドレス',
    'register.emailPlaceholder': 'example@example.com',
    'register.passwordLabel': 'パスワード',
    'register.passwordPlaceholder': '8文字以上のパスワード',
    'register.usernameLabel': 'ユーザー名（任意）',
    'register.usernamePlaceholder': 'Meal Log 太郎',
    'register.submit': '登録する',
    'register.error.generic': '登録に失敗しました。時間をおいて再度お試しください。',
    'register.validation.missing': 'メールアドレスとパスワードを入力してください。',
    'register.backToLogin': 'すでにアカウントがありますか？ログインする',
    'settings.title': '設定',
    'settings.section.account': 'アカウント',
    'settings.section.language': '言語',
    'settings.section.profile': 'プロフィールと目標',
    'settings.section.notifications': '通知',
    'settings.section.legal': '法務',
    'settings.section.feedback': 'フィードバック',
    'settings.section.about': 'このアプリについて',
    'settings.language.heading': '表示言語',
    'settings.language.changedTitle': '言語を変更しました',
    'settings.language.changedMessage': '一部の画面では再読み込み後に反映されます。',
    'settings.plan.heading': 'ご利用プラン',
    'settings.plan.standard': 'Standard プランをご利用中です。',
    'settings.plan.free': '無料プランをご利用中です。',
    'settings.account.email': 'メールアドレス',
    'settings.account.guest': 'ゲスト',
    'settings.account.logout': 'ログアウト',
    'settings.account.changePassword': 'パスワードを変更する',
    'settings.account.deleteAccount': 'アカウントを削除する',
    'settings.account.logoutError': 'ログアウトに失敗しました',
    'settings.account.deleteTitle': 'アカウントを削除しますか？',
    'settings.account.deleteMessage': '全ての記録が削除され復元できません。本当に削除しますか？',
    'settings.account.deleteConfirm': '削除する',
    'settings.account.deleteSuccessTitle': 'アカウントを削除しました',
    'settings.account.deleteSuccessMessage': 'ご利用ありがとうございました。',
    'settings.account.deleteErrorTitle': '削除に失敗しました',
    'settings.account.deleteErrorMessage': '時間をおいて再度お試しください。',
    'settings.profile.namePlaceholder': 'お名前を登録しましょう',
    'settings.profile.subtitle': 'プロフィールを編集して目標を管理できます',
    'settings.account.screenDescription': 'アカウント情報の管理、パスワード変更、削除などはこちらから行えます。',
    'settings.account.screenPlaceholder': '近日中に、メールアドレスやパスワードの変更機能を提供予定です。',
    'settings.account.openWeb': 'サポートページを開く',
    'settings.profile.targetCalories': '目標カロリー',
    'settings.profile.targetProtein': '目標たんぱく質',
    'settings.profile.targetFat': '目標脂質',
    'settings.profile.targetCarbs': '目標炭水化物',
    'settings.profile.bodyWeight': '目標体重',
    'settings.profile.activityLevel': '活動レベルメモ',
    'settings.profile.activityPlaceholder': '例: 週3回トレーニング',
    'settings.profile.save': '保存する',
    'settings.profile.savedTitle': '保存しました',
    'settings.profile.savedMessage': 'プロフィールの目標値を更新しました。',
    'settings.profile.errorTitle': '保存に失敗しました',
    'settings.profile.errorMessage': '時間をおいて再度お試しください。',
    'settings.profile.validationTitle': '入力内容を確認してください',
    'settings.profile.validationMessage': '数値には0以上の値を入力してください。',
    'settings.notifications.placeholder': '通知設定は近日対応予定です。',
    'settings.invite.header': '友だちを招待',
    'settings.invite.title': '一緒に記録を続けませんか？',
    'settings.invite.subtitle': '紹介した友達が参加するとボーナスを獲得できます。',
    'settings.invite.cta': '招待リンクを共有',
    'settings.invite.toast': '共有メニューから招待リンクを送信してください。',
    'referral.share.title': 'Meal Logを一緒に使いませんか？',
    'referral.share.message': 'このリンクから登録すると14日間プレミアム無料！友だちを紹介すると30日延長も！ {{link}}',
    'referral.invite.rewardText': '友だち1人で30日延長',
    'referral.friend.rewardText': '紹介なら14日間プレミアム無料',
    'referral.error.loadFailed': '招待リンクの取得に失敗しました',
    'referral.error.shareFailed': '共有に失敗しました',
    'referral.status.title': '紹介プログラム',
    'referral.status.inviteCode': '招待コード',
    'referral.status.stats.total': '紹介人数',
    'referral.status.stats.completed': '達成',
    'referral.status.stats.pending': '待機中',
    'referral.status.stats.daysEarned': '獲得日数',
    'referral.status.recent': '最近の紹介',
    'referral.status.status.pending': '待機中',
    'referral.status.status.completed': '達成',
    'referral.status.status.expired': '期限切れ',
    'referral.status.consecutiveDays': '{{days}}/3日',
    'referral.status.copy': 'コピー',
    'referral.status.share': '共有',
    'referral.status.copied': 'コピーしました',
    'settings.menu.personal': 'プロフィール情報',
    'settings.menu.nutrition': '栄養目標を編集',
    'settings.menu.weight': '目標と現在の体重',
    'settings.menu.history': '履歴を見る',
    'settings.menu.language': '表示言語',
    'settings.profile.screenTitle': 'プロフィールと目標',
    'settings.notifications.screenTitle': '通知設定',
    'settings.notifications.reminder': '食事記録のリマインダー',
    'settings.notifications.comingSoon': '通知設定は現在準備中です。',
    'settings.legal.privacy': 'プライバシーポリシー',
    'settings.legal.terms': '利用規約',
    'settings.legal.oss': 'OSSライセンス',
    'settings.feedback.description': 'ご意見・ご要望はメールでお気軽にお送りください。',
    'settings.feedback.sendMail': 'フィードバックを送る',
    'settings.about.version': 'アプリバージョン {{version}}',
    'settings.about.developer': '開発: Meal Log チーム',
    'card.confidence': '信頼度 {{value}}%',
    'card.share': '共有',
    'card.edit': '編集',
    'card.warnings.zeroFloored': 'AIが推定した栄養素の一部が0として返されました。値を確認してください。',
    'card.languageFallback': '※ {{requested}} の翻訳が未対応のため {{resolved}} で表示しています',
    'unit.kcal': 'kcal',
    'unit.gram': 'g',
  },
  'en-US': {
    'dashboard.title': 'Dashboard',
    'dashboard.cacheNotice': 'Offline data shown from cache.',
    'dashboard.requiresLogin': 'Sign-in required.',
    'dashboard.loginHint': 'Please log in from the chat tab.',
    'dashboard.loadError': 'Failed to load data.',
    'dashboard.reloadHint': 'Pull down to refresh.',
    'dashboard.empty.week': 'No logs this week',
    'dashboard.empty.generic': 'No logs yet',
    'dashboard.logout': 'Log out',
    'dashboard.summary.remainingToday': 'Remaining (today)',
    'dashboard.summary.periodTotal': 'Intake (period total)',
    'dashboard.monthlyDeficit.title': 'Monthly calorie delta',
    'dashboard.monthlyDeficit.subtitle': '{{days}} days · Avg {{daily}}',
    'button.record': 'Log a meal',
    'period.today': 'Today',
    'period.yesterday': 'Yesterday',
    'period.thisWeek': 'This week',
    'period.lastWeek': 'Last week',
    'period.custom': 'Custom period',
    'period.previousRange': 'Previous range',
    'tab.calories': 'Calories',
    'tab.macros': 'Macros',
    'tab.nutrients': 'Nutrients',
    'tab.chat': 'Chat',
    'tab.dashboard': 'Dashboard',
    'tab.settings': 'Settings',
    'macro.protein': 'Protein',
    'macro.fat': 'Fat',
    'macro.carbs': 'Carbs',
    'meal.breakfast': 'Breakfast',
    'meal.lunch': 'Lunch',
    'meal.dinner': 'Dinner',
    'meal.snack': 'Snacks',
    'meal.unknown': 'Unknown',
    'comparison.heading': 'Compared with {{period}}',
    'comparison.current': 'Current',
    'comparison.previous': 'Previous',
    'comparison.target': 'Target',
    'comparison.targetShort': 'Target',
    'comparison.delta': 'Delta',
    'comparison.macroDelta': '{{delta}}g',
    'comparison.percentOfTarget': 'Target ratio {{value}}',
    'status.over': 'Over',
    'status.under': 'Left',
    'status.onTarget': 'On target',
    'nutrients.header.nutrient': 'Nutrient',
    'nutrients.header.total': 'Total',
    'nutrients.header.target': 'Target',
    'nutrients.header.delta': '+/-',
    'mealDistribution.heading': 'Meal balance',
    'mealDistribution.current': 'Current',
    'mealDistribution.previous': 'Previous',
    'mealDistribution.delta': 'Δ',
    'macros.donut.title': 'PFC balance',
    'macros.donut.legend.current': 'Current',
    'remaining.calories': 'Calories left',
    'remaining.caloriesOver': 'Calories over',
    'remaining.left': '{{nutrient}} left',
    'remaining.over': '{{nutrient}} over',
    'remaining.target': 'Target {{value}}',
    'rings.of_target': 'Current / Target',
    'rings.left': '{{value}} {{unit}} left',
    'rings.over': '{{value}} {{unit}} over',
    'rings.no_target': 'No target set',
    'rings.accessible': '{{label}} {{current}} {{unit}} / {{target}} {{unit}}, {{delta}} {{unit}} {{status}}',
    'rings.accessibleNoTarget': '{{label}} {{current}} {{unit}}, target not set',
    'recentLogs.heading': 'Recent meals',
    'recentLogs.empty': 'No meals logged yet. Start tracking your meals!',
    'recentLogs.resetNotice': 'On the free plan, your history resets every 30 days. Switch to the Standard plan to keep all of your records.',
    'recentLogs.addMore': 'Log a meal',
    'recentLogs.viewAll': 'View all',
    'history.title': 'Meal history',
    'history.subtitle': 'Switch the range to browse older entries.',
    'history.range.today': 'Today',
    'history.range.week': '1 week',
    'history.range.twoWeeks': '2 weeks',
    'history.range.threeWeeks': '3 weeks',
    'history.range.month': '1 month',
    'history.timezone': 'Times shown in {{timezone}}',
    'history.empty': 'No meals in this range.',
    'history.delete.confirmTitle': 'Delete this entry?',
    'history.delete.confirmMessage': 'Delete {{dish}} from your history?',
    'history.delete.failedTitle': 'Failed to delete',
    'history.delete.failedMessage': 'Please try again in a moment.',
    'history.delete.successTitle': 'Entry removed',
    'history.delete.successMessage': 'Tap Undo if you need it back.',
    'history.delete.undo': 'Undo',
    'history.restore.success': 'Entry restored',
    'history.restore.failed': 'Failed to restore',
    'history.timeHistory.none': 'Not set',
    'history.timeHistory.source.auto': 'Auto',
    'history.timeHistory.source.manual': 'Manual edit',
    'history.timeHistory.empty': 'No time tag changes yet.',
    'logs.deleteConfirm.title': 'Delete this log?',
    'logs.deleteConfirm.message': 'The entry will be removed from the list unless you undo the action.',
    'logs.deleted.title': 'Log deleted',
    'logs.deleted.message': 'Tap Undo if you removed it by mistake.',
    'logs.deleted.undo': 'Undo',
    'logs.deleted.failed': 'Failed to delete the log',
    'logs.restore.failed': 'Failed to restore the log',
    'logs.restore.success': 'Log restored',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.close': 'Close',
    'usage.limitModal.title': 'Free usage limit reached',
    'usage.limitModal.message': 'The free plan allows {{limit}} AI requests per day. Upgrade to the Standard plan to keep logging without waiting.',
    'usage.limitModal.purchase': 'Switch to Standard plan',
    'usage.limitModal.close': 'Close',
    'usage.streakModal.title': 'Congrats on 30 days!',
    'usage.streakModal.message': 'On the free plan, your history resets every 30 days. Stay on track by switching to the Standard plan.',
    'usage.streakModal.upgrade': 'Switch to Standard plan',
    'usage.streakModal.close': 'Later',
    'usage.purchase.error': 'Failed to complete the purchase',
    'usage.purchase.unsupported': 'Purchases are not supported on this device.',
    'usage.purchase.success': 'Credits added to your account',
    'usage.plan.standard': 'Standard plan',
    'usage.plan.free': 'Free plan',
    'usage.banner.remaining': 'Remaining {{remaining}} / {{limit}}',
    'usage.banner.credits': 'Credits {{credits}} left',
    'usage.limitHint': 'You\'ve hit today\'s free limit. Switch to the Standard plan to keep logging.',
    'export.header.date': 'Recorded at',
    'export.header.name': 'Meal',
    'export.header.calories': 'Calories (kcal)',
    'export.header.protein': 'Protein (g)',
    'export.header.fat': 'Fat (g)',
    'export.header.carbs': 'Carbs (g)',
    'export.title': 'Meal Log',
    'chat.header': 'Today\'s meals',
    'chat.newLog': 'New log',
    'chart.placeholder.insufficientData': "Not enough data to show today's trend",
    'streak.days': 'days streak',
    'login.title': 'Meal Log',
    'login.subtitle': 'Log your meals and let AI estimate nutrients.',
    'login.emailLabel': 'Email address',
    'login.emailPlaceholder': 'you@example.com',
    'login.passwordLabel': 'Password',
    'login.passwordPlaceholder': '••••••••',
    'login.submit': 'Sign in',
    'login.error.generic': 'Failed to sign in. Please try again.',
    'login.register': 'Create account',
    'register.title': 'Create an account',
    'register.subtitle': 'Enter your email and password to get started.',
    'register.emailLabel': 'Email address',
    'register.emailPlaceholder': 'you@example.com',
    'register.passwordLabel': 'Password',
    'register.passwordPlaceholder': 'At least 8 characters',
    'register.usernameLabel': 'Display name (optional)',
    'register.usernamePlaceholder': 'Meal Log User',
    'register.submit': 'Sign up',
    'register.error.generic': 'Sign-up failed. Please try again soon.',
    'register.validation.missing': 'Email and password are required.',
    'register.backToLogin': 'Already have an account? Log in',
    'settings.title': 'Settings',
    'settings.section.account': 'Account',
    'settings.section.language': 'Language',
    'settings.section.profile': 'Profile & goals',
    'settings.section.notifications': 'Notifications',
    'settings.section.legal': 'Legal',
    'settings.section.feedback': 'Feedback',
    'settings.section.about': 'About this app',
    'settings.language.heading': 'Display language',
    'settings.language.changedTitle': 'Language updated',
    'settings.language.changedMessage': 'Some screens may require a refresh to update.',
    'settings.plan.heading': 'Subscription plan',
    'settings.plan.standard': 'You are on the Standard plan.',
    'settings.plan.free': 'You are on the Free plan.',
    'settings.account.email': 'Email',
    'settings.account.guest': 'Guest',
    'settings.account.logout': 'Log out',
    'settings.account.changePassword': 'Request password change',
    'settings.account.deleteAccount': 'Delete account',
    'settings.account.logoutError': 'Failed to log out. Please try again.',
    'settings.account.deleteTitle': 'Delete your account?',
    'settings.account.deleteMessage': 'All saved data will be removed permanently. This action cannot be undone.',
    'settings.account.deleteConfirm': 'Delete',
    'settings.account.deleteSuccessTitle': 'Account deleted',
    'settings.account.deleteSuccessMessage': 'Thanks for using Meal Log.',
    'settings.account.deleteErrorTitle': 'Failed to delete',
    'settings.account.deleteErrorMessage': 'Please try again in a few moments.',
    'settings.profile.namePlaceholder': 'Add your name',
    'settings.profile.subtitle': 'Keep your goals and profile up to date',
    'settings.account.screenDescription': 'Manage your account details, password, and deletion options here.',
    'settings.account.screenPlaceholder': 'Password and email changes will be available soon.',
    'settings.account.openWeb': 'Open support site',
    'settings.profile.targetCalories': 'Target calories',
    'settings.profile.targetProtein': 'Target protein',
    'settings.profile.targetFat': 'Target fat',
    'settings.profile.targetCarbs': 'Target carbs',
    'settings.profile.bodyWeight': 'Goal weight',
    'settings.profile.activityLevel': 'Activity notes',
    'settings.profile.activityPlaceholder': 'e.g. train 3x per week',
    'settings.profile.save': 'Save goals',
    'settings.profile.savedTitle': 'Profile updated',
    'settings.profile.savedMessage': 'Your targets were saved successfully.',
    'settings.profile.errorTitle': 'Unable to save',
    'settings.profile.errorMessage': 'Please try again shortly.',
    'settings.profile.validationTitle': 'Check your inputs',
    'settings.profile.validationMessage': 'Please enter non-negative numbers only.',
    'settings.notifications.placeholder': 'Notification settings will be available soon.',
    'settings.invite.header': 'Invite friends',
    'settings.invite.title': 'Share the journey',
    'settings.invite.subtitle': 'Invite friends and celebrate progress together.',
    'settings.invite.cta': 'Share invite link',
    'settings.invite.toast': 'Use your sharing menu to send an invite link.',
    'referral.share.title': 'Join me on Meal Log!',
    'referral.share.message': 'Sign up with this link to get 14 days of premium free! Refer friends and get 30 extra days! {{link}}',
    'referral.invite.rewardText': '30 days per friend',
    'referral.friend.rewardText': '14 days free with referral',
    'referral.error.loadFailed': 'Failed to load invite link',
    'referral.error.shareFailed': 'Failed to share',
    'referral.status.title': 'Referral Program',
    'referral.status.inviteCode': 'Invite Code',
    'referral.status.stats.total': 'Total Referred',
    'referral.status.stats.completed': 'Completed',
    'referral.status.stats.pending': 'Pending',
    'referral.status.stats.daysEarned': 'Days Earned',
    'referral.status.recent': 'Recent Referrals',
    'referral.status.status.pending': 'Pending',
    'referral.status.status.completed': 'Completed',
    'referral.status.status.expired': 'Expired',
    'referral.status.consecutiveDays': '{{days}}/3 days',
    'referral.status.copy': 'Copy',
    'referral.status.share': 'Share',
    'referral.status.copied': 'Copied',
    'settings.menu.personal': 'Personal details',
    'settings.menu.nutrition': 'Edit nutrition goals',
    'settings.menu.weight': 'Goals & current weight',
    'settings.menu.language': 'Language',
    'settings.profile.screenTitle': 'Profile & goals',
    'settings.notifications.screenTitle': 'Notifications',
    'settings.notifications.reminder': 'Meal log reminder',
    'settings.notifications.comingSoon': 'Notification settings are coming soon.',
    'settings.legal.privacy': 'Privacy policy',
    'settings.legal.terms': 'Terms of service',
    'settings.legal.oss': 'Open source licenses',
    'settings.feedback.description': 'We’d love to hear from you. Send us an email anytime.',
    'settings.feedback.sendMail': 'Send feedback email',
    'settings.about.version': 'App version {{version}}',
    'settings.about.developer': 'Built by the Meal Log team',
    'card.confidence': '{{value}}% confidence',
    'card.share': 'Share',
    'card.edit': 'Edit',
    'card.warnings.zeroFloored': 'Some nutrients were returned as zero. Please double-check them.',
    'card.languageFallback': '※ Showing {{resolved}} because {{requested}} is not translated yet',
    'unit.kcal': 'kcal',
    'unit.gram': 'g',
  },
};

let currentLocale: Locale = DEFAULT_LOCALE;
const listeners = new Set<() => void>();

function emit() {
  for (const listener of listeners) {
    listener();
  }
}

function subscribe(listener: () => void) {
  listeners.add(listener);
  return () => listeners.delete(listener);
}

function snapshot() {
  return currentLocale;
}

function resolveTemplate(template: string, params?: Record<string, string | number>) {
  if (!params) {
    return template;
  }
  return template.replace(/\{\{(\w+)\}\}/g, (_match, key) => {
    const value = params[key];
    return value === undefined ? '' : String(value);
  });
}

function translate(locale: Locale, key: string, params?: Record<string, string | number>) {
  const template = dictionaries[locale][key] ?? dictionaries['ja-JP'][key] ?? key;
  return resolveTemplate(template, params);
}

export function setLocale(locale: Locale) {
  if (locale === currentLocale) {
    return;
  }
  currentLocale = locale;
  emit();
}

export function getLocale() {
  return currentLocale;
}

export function useTranslation() {
  const locale = useSyncExternalStore(subscribe, snapshot, snapshot);
  const t = (key: string, params?: Record<string, string | number>) => translate(locale, key, params);
  return {
    t,
    locale,
    setLocale,
  } as const;
}

export type { Locale };

export function getIntlLocale(locale: Locale = currentLocale) {
  return locale.startsWith('ja') ? 'ja' : 'en';
}
